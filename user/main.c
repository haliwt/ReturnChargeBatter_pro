/**
*   ************************************************************************************
*								�1�7�0�8�1�7���0�0�1�7�1�7�1�7�0�7�0�4�1�7�1�7�1�7�1�7�1�1�1�7�0�4
*								    www.holychip.cn
*	************************************************************************************
*	@Examle Version		V1.0.0.0
*	@Demo Version		V1.0.1.0
*	@Date				2017.09.18
*	************************************************************************************
*									 �0�0�1�7�1�7�1�7�1�7�1�7�1�7�1�7�1�7�1�7
*	1�1�7�1�7�1�7�1�7�1�7�0�9�1�7�1�7SMT�1�7�1�7�0�0�0�4�1�7�1�7VDD=5V�0�2�1�7�1�7�1�7�0�3�1�7�0�9�1�7�1�7�1�7�1�7�1�7�1�7�0�3�1�7�0�9�1�7�1�7VIL1�1�7�1�7�1�7�1�7���0�20~1.5V�1�7�1�7�1�7�1�1�1�7�0�9�1�7�1�7�1�7�1�7�1�7�1�7
*	   �1�7�1�1�1�7�0�9�1�7�1�7VIH1�1�7�1�7�1�7�1�7���0�23.5~5V�1�7�1�7
*	2�1�7�1�7�1�7�1�7�1�7�0�9SMT�1�7�1�7�0�0�0�4�1�7�1�7VDD=5V�0�2�1�7�1�7�1�7�0�3�1�7�0�9�1�7�1�7�1�7�1�7�1�7�1�7�0�3�1�7�0�9�1�7�1�7VIL1�1�7�1�7�1�7�1�7���0�20~1V�1�7�1�7�1�7�1�1�1�7�0�9�1�7�1�7�1�7�1�7�1�7�1�7�1�1�1�7
*	   �0�9�1�7�1�7VIH1�1�7�1�7�1�7�1�7���0�24~5V�1�7�1�7
*	3�1�7�1�7P0xDBCT [5:0]�1�7�1�7�1�7�0�1�1�7�1�7�1�7�1�7�1�7�0�2�1�7�1�7�1�7�1�7�0�5�1�7�1�7�1�7�1�7���1�7�1�7�1�7�1�7�0�1�0�3�1�7�1�7*Tosc*P0xDBCT[5:0]-Tosc<�1�7�1�7�1�7�1�7�0�2�1�7�1�7<
*	   �1�7�1�7�0�1�0�3�1�7�1�7*Tosc*(P0xDBCT[5:0]+1)-Tosc�1�7�1�7
	4�1�7�1�7HC89F003�1�7�0�3�y�˄1�7�0�4�1�7�1�7�1�7�1�7�1�7�1�7�1�7�˄1�7�1�7�1�7�1�9�0�0�1�7�˄1�7�1�7�1�7�1�7�1�7�ք1�7IO�1�7�1�7�1�0�0�6�1�7�1�7�1�7�1�7�1�7�1�7�1�7�0�8�1�7�0�2�0�8�1�7�1�7�0�5�1�7�1�7
*	************************************************************************************
*									 �0�8�1�7�1�7�0�0�1�7�1�7�1�7�1�7�1�7�1�7
*	1�1�7�1�7�1�7�1�7�0�0�1�7�1�7�1�7�1�7�1�7�1�7�0�2�1�7�1�7�1�7�1�7JTAG�1�7�1�7�1�7�0�1�1�7IO�1�7�1�7�1�7�1�7�؄1�7�0�0�1�7�1�7�Մ1�7�1�7�1�7�1�7�1�7�1�7�1�7�4�4�1�7�1�7�1�7�1�7�0�3�1�7�1�7�1�7�0�0�1�7�1�7�1�7�1�7�1�7�1�7�0�2�1�7�1�7�0�8
*	   �1�7�1�7�1�7�1�7�1�7�9�8�1�7�1�7IO�1�7�1�1�1�7�1�7�0�3�1�7�1�7�1�7�1�7�1�7�1�7�1�7�0�0�1�7�0�1�1�7�0�6�1�7�1�7�1�7�Ʉ1�7�1�7�1�7�1�7�1�7�1�7�1�7�1�7�1�7�1�7�1�7�1�7�1�7�1�7
*	2�1�7�1�7�1�7�1�7�1�7�5�3P0.0/P0.1/P0.2�1�7�1�7�1�7�1�7�1�7�1�7�1�7�1�7�1�7�1�7�0�3�0�1�1�7�1�7�1�7�0�8�1�7�1�7�8�9�1�7�؄1�7�1�7�1�7�1�7�0�5�1�7�1�7�1�7�0�0�1�7�1�7�1�7�1�7�1�7�0�8�1�7�1�7�1�7�1�7�1�7�1�7�1�7�1�7�1�7�1�7�0�1�1�7
*   3�1�7�1�7HC89F003�1�7�1�7B�1�7�p�1�7�1�7�1�7�0�2�1�7�ڄ1�7�1�7IO�1�7�1�7P23�1�7�1�7P24�1�7�1�7P25�1�7�1�7P27�1�7�1�7�1�7�1�7�1�7�1�7�1�7�1�7�1�7�1�7�1�7�1�7�1�7�1�7�1�7�1�7�1�7�1�7�0�4�0�2�0�0�1�7�1�9�0�1�1�7�1�7�1�1�1�7
       �1�7�1�7�1�7�0�4�1�7�1�7�1�7�1�7�1�7�0�0�1�7�0�0�1�7�1�7�1�7�1�7�1�7�1�7�1�7�1�7�1�7�1�7�0�4�1�7�1�7�1�7�1�7�1�7�1�7�1�7�1�7�1�7�1�7�0�3�1�7�1�7�1�7�0�6�1�7�1�7�1�7�0�0�1�7�0�0�1�7�0�4�1�7�1�7�1�7�1�7�1�7�1�7�1�7�1�7�1�7�1�7�1�7�1�7�1�7�0�4�1�7�1�7�1�7�0�4�1�7�1�7�1�7�1�7
       �1�7�1�7�1�7�1�7�1�7�1�7�1�7�0�3�1�7�1�7�1�7�1�7�1�7�1�7�1�7DateSheet�1�7�1�7�1�7�1�7�1�7�1�7�1�7�1�7���0�2�1�7�ڄ1�7�1�7�1�7�1�7�1�7�1�7�1�7�0�9�1�7�0�5�1�7�1�7�1�7�1�7�1�7�1�7�0�4�1�7�0�9�1�7�1�7�0�9�1�7�1�7
*	************************************************************************************
*  								       �1�7�0�9�1�7�1�7�1�7�1�7�1�7
*	�1�7�1�7�݄1�7�1�7�0�0�1�7�1�7�1�7�1�7�1�7�0�7�0�7�1�7�0�2�1�7�1�7�1�7�1�7�1�7�1�7�1�7�1�7�1�7�0�4�1�7�1�7�1�7�1�7�0�2�1�7�1�7�1�7�1�7�1�7�0�0�1�7�0�0�1�7�1�7�1�7�1�7�1�7�1�7�0�6�1�7�1�7�1�7�1�7�1�7�1�7�1�7�1�7�0�8�1�7���0�0�1�7�1�7�1�7�0�7�1�9�1�7QQ�0�5
*	****************************�1�7�1�7�1�7�1�7�0�1�1�7�1�7�0�5�1�7�1�7201030494***********************************
*   ************************************************************************************
**/
#define	ALLOCATE_EXTERN
#define	ver 5

#include "HC89F0541.h"

#include "..\lib\LB_Led.h"
#include "..\lib\LB_AD.h"
#include "..\lib\LB_Usart.h"
#include "..\lib\LB_eeprom.h"
#include "..\lib\LB_Motor.h"
#include "..\lib\LB_IR.h"
#include "..\lib\LB_Run.h"
#include "..\lib\LB_Mode.h"
#include "..\lib\LB_Key.h"

unsigned int gui_T5Value;               //T5 �1�7�1�7�1�7�1�7�1�7�0�0�0�5
unsigned int gui_newT5Value = 0;		//T5 �1�7�1�7�1�7�1�7�1�7�0�0�1�7�1�7�0�5
unsigned int gui_oldT5Value = 0; 		//T5 �1�7�1�7�1�7�1�7�1�7�0�0�1�7�1�7�0�5

void InitSysclk(INT8U SYS)
{

	/************************************�0�3�0�1�1�7�1�7�0�3�1�7�1�7****************************************/
	WDTCCR = 0x00;						//�1�7�1�9�0�1�1�7�1�7�0�1�1�7

	while((CLKCON&0x20)!=0x20);			//�1�7�0�9�1�7�1�7�1�8�1�7�1�7�1�7�0�1�1�7�1�7�1�7�1�7�1�7�1�7�1�7�1�7
	CLKSWR = 0x51;						//�0�5�1�7�1�7�1�7�1�8�1�7�1�7�1�7�0�1�0�2�1�7�1�7�0�2�1�7�1�7�0�2�1�7�0�5�1�7�1�7�1�8�1�7�1�7�1�7�0�1RC2�1�7�1�7�0�1�1�7�1�7Fosc=16MHz
	while((CLKSWR&0xC0)!=0x40);			//�1�7�0�9�1�7�1�7�1�8�1�7�1�7�1�7�0�1�1�7�݄1�7�1�7�1�7�1�7
	CLKDIV = SYS;						//Fosc1�1�7�1�7�0�1�1�7�0�1�1�7Fcpu�1�7�1�7Fcpu=16MHz
}



/***************************************************************************************
  * @�0�6�1�7�1�7���1�7�1�7	�1�7�1�7P02�1�7�0�5�1�1�1�7�1�7�1�7�1�7�1�7�1�7�1�7�1�7�1�7�1�7�1�7�1�7�1�7�0�2100K

�1�7�1�7�1�7�1�73004�1�7�1�7�1�7�1�7�0�1�1�7�1�7�0�9�1�7�1�9�1�7�1�7�1�7�1�7�1�0�1�7�1�7�1�7??????? 2020.09.09
?
�1�7�1�7�1�7�1�7�1�7�1�7�1�7�1�7�1�7�1�7
1.???? �1�7�1�7�1�7�1�7�1�7�1�7�1�7�1�7�1�7�1�7�1�7��1�7�1�7 
?
2.???? �1�7�1�7�1�7�1�7�0�5�1�7�1�7�1�7�ք1�7�1�7�0�6�1�7�1�7�1�7�1�7
?
3.�1�7�1�7�0�9�0�0�0�4:
3.1. �1�7�1�7�1�7�1�7�1�7�1�7�1�7�1�7�0�9�0�0�0�4�1�7�1�7�1�7�1�7�1�7�1�7�0�8�1�7�1�7�1�7�1�7�1�7�0�0�0�4�1�7�1�7�1�7�1�7
3.2. �1�7�0�9�1�7�1�7�1�7�0�9�0�0�0�4�1�7�1�7�1�7�1�7�1�7�1�5�1�7�1�7�1�7�1�7�1�7�1�7�1�7�0�9�0�0�0�4�1�7�0�5�1�7 30�1�7�1�7�1�7�1�7�1�7�1�7�0�6�0�45�1�7�1�7�1�7�0�8�1�7�1�7�1�7�1�7�1�7�1�7�0�9�1�7�1�7�1�7�0�9�0�0�0�4�1�7�1�7
3.3 �1�7�1�7�1�7�1�7�1�7�1�7�0�9�0�0�0�4�1�7�1�7 
3.4. �1�7�0�9�1�7�1�7�1�7�0�9�0�0�0�4�1�7�1�7�1�7�1�7�0�0�1�7�1�7�0�1�1�7�1�7�1�7�1�7�1�7�1�7�1�5�1�7�1�7�1�7�1�7�1�7�1�7�1�7�1�7�1�7�1�7�0�1�1�7�1�7�1�7
?
4.�1�7�1�7�1�7�1�7�1�7�1�7�0�1�1�7�1�7: �0�2�1�7�1�7�1�7�1�7�1�7�1�7�1�7�0�9�1�7�1�7�0�3�1�7�1�7�1�7�1�7�1�7�1�7�1�73�1�7�1�7�1�7�1�7�1�7�1�7�1�7�1�7�0�5�1�7�1�7�1�7�1�7�1�7�0�3�1�3�1�7�1�7�1�7�1�7�1�7�0�6�1�7�1�3�0�5�0�3�0�0�1�7�1�7
?
5.�1�7�1�7�ք1�7�1�7�0�6�1�7�1�7�7�4�1�7�1�7�1�71�7�ބ1�7�0�5�1�7�1�7�1�7�1�7�9�6�1�7�1�5�1�7�1�7�1�7�1�7�1�7�1�7�1�7�1�7�1�7�1�7�0�5�1�7�1�7�1�7�5�5�1�7�1�7�1�7�1�7
?
6.�1�7�1�7�1�7�1�7�1�7�1�7�1�7�1�7�1�7�1�7�1�7�1�7�0�5�0�9�1�7�1�7�1�7�1�7�1�7�1�7�1�7�1�6�1�7�1�7�1�7�1�7�1�7�0�9�1�7�1�7�1�7�1�7�0�0�0�4�1�7�1�7�1�7�1�7�1�7�0�3�1�3�1�7�1�7�1�7�1�7�1�7�1�7�1�7�0�9�0�2�1�7�1�7�1�7�1�6�0�8�1�7�1�7�1�7�1�7�1�7�1�7�1�7/�1�7�1�7�0�5�1�7�1�7�1�7�1�7,�1�7�1�7�1�7�1�6�1�7�1�7�1�7�1�7�1�7�1�7�1�7�1�7�0�2�1�7�1�7�0�0�0�4�1�7�1�7�1�7�1�3�1�7�1�7�0�8�0�0.
?
7.�1�7�1�7�1�7�1�5�1�7�1�7�1�7�1�7�1�7�1�7�1�7�1�7�1�7�1�7�1�7�1�9�1�7�0�6�1�7�1�7�1�7�1�5�1�7�1�7�1�7�1�7�1�7�1�7�1�7�1�7�1�7�1�7�1�7�1�7�0�3�1�7�1�7�1�7�1�7�1�7�0�6�1�7�1�7�1�7�1�7�0�2�1�7�1�7�1�7�1�7�1�7�1�7�0�8�1�7�0�7�1�7�1�7�1�7�1�7�1�7�1�7�1�7�0�9�0�0�0�4.
�1�7�1�7�1�7�1�7�1�7�1�7�1�7�1�7�1�7�1�7�1�7�1�5�1�7�1�7�1�7�1�7�0�2�1�7�1�7�1�7�1�7�1�7�1�7�0�9�1�7�1�7�1�8�1�7�1�7�1�7�1�7�1�7�1�7�0�5�1�7�0�2�1�7�1�7�0�5/�1�7�1�7�1�7�1�7�1�7�1�7�1�7�1�7�1�7�1�3�0�5�0�3�0�0�1�7�1�7
?
8.???? �1�7�1�7�0�6�1�7�1�7�1�7�1�7�0�3�1�7�1�77.4V�1�7�1�7�1�7�1�7�1�7�1�73.7V�1�7�1�7�1�7�1�72000MAH�1�7�1�7
?
8.1 USB5V�1�7�1�7���1�7�1�7�1�7�1�7�0�2 MICRO? USB
?
8.2 �1�7�1�7�1�7�1�7�1�7�1�7�0�20.65A,�1�7�1�7�1�7�1�7�1�7�1�7�B�0�4�1�7�1�7�1�7�1�7�1�7�1�7�1�7�1�7�1�7�1�7�1�7�1�7�1�7�1�7�1�7�1�7�1�7�1�7�1�7�1�7�1�7�1�7�0�9�0�1�1�7�1�7�1�7�1�7�1�7�1�7ӹ�0�5�1�7�1�7�1�7�1�7�1�75MM�0�5�0�2�1�7�0�3�1�7
?
8.3 �1�7�1�7�1�7�0�7�1�7�0�9�0�26V,�1�7�1�7�1�7�1�7�1�7�0�3�1�7�0�9�1�7�1�7�1�7�1�7�1�7�1�7�1�7�1�7�1�7�1�7�1�7�1�7�1�7�1�7�1�7�1�7�1�7�3�9�1�7�1�7�1�7�1�7�1�7�0�9�1�7�1�7�0�9�0�28.4V�1�7�1�7
?
9.???? �1�7�1�7�1�7�1�7�1�7�1�7�1�7�1�7: �1�7�τ1�7�1�7�0�8�1�7�0�6�0�6�1�7�1�7�1�7�9�1 RC-365SH-1992-52K �1�7�1�7�1�7�1�7�1�7�1�7�0�96.8V�1�7�1�7�1�7�1�7�1�7�1�7�1�7�1�7�1�7�1�7�1�9�1�7�1�7�1�7�1�7�1�7
?
�1�7�1�7�1�7�1�7�1�7�1�7�1�7�1�7�0�8�1�7�1�7�1�7�1�7�1�7�1�7���1�7�Ʉ1�7�1�7�1�7�1�7�1�7�1�7�0�4�1�7�5�9PCB�1�7�1�7�1�7�0�5�1�7�1�7�1�7�1�7�1�7�1�7�1�7�1�7�1�7�1�7�1�7�1�7�1�7�1�7�1�7�1�7�1�7�1�7�1�7�1�7�1�7�1�7�1�7�1�7�0�5�1�7
?
10.? �1�7�1�7�0�9�1�7�1�7�1�7�1�7: �1�7�τ1�7�1�7�0�8�0�7�1�7�0�6�1�7�1�7�1�7�9�1320CH-11480 �1�7�1�7�1�7�1�7�1�7�1�7�1�7�1�7�0�96.8V, �1�7�1�7�1�7�1�7�1�7�1�7�1�7�1�7�1�9�1�7�1�7�1�7�1�7�1�7
?
11.�1�7�1�7�1�7�1�7�1�7�1�7�1�7�1�7: �1�7�τ1�7�1�7�0�8�1�7�0�6�0�6�1�7�1�7�1�7�9�1YRK-370SH-24110 D/V6.8�1�7�1�7�1�7�1�7�1�7�1�7�0�96.8V, �1�7�1�7�1�7�1�7�1�7�1�7�1�7�1�7�1�9�1�7�1�7�1�7�1�7�1�7
?
�1�7�1�7�1�7�1�7�1�7�1�7�0�5�1�7�1�7
?
1.???? �1�7�1�7�1�7�1�7�1�7�1�7�0�9�1�7�1�7�1�7�1�7�1�7�1�7�1�7�1�7�1�7�0�7�1�7�1�75�1�7�1�7�1�7�1�7�0�5�1�7�1�7�1�7�1�7�1�7�1�7�1�7�1�7
2.???? �1�7�1�7�1�7�1�7�1�7�1�7�1�7�0�3�1�7�1�7�1�7�1�7�1�7�1�7�1�7�1�7�0�7�1�7�1�75�1�7�1�7�1�7�1�7�1�7�1�7�1�7�1�7�1�7�1�7�1�7�1�7�1�7�1�7
3.???? �1�7�1�7�0�9�1�7�1�7�1�7�1�7�1�7�0�8�1�7�1�7�1�7�1�7�1�7�1�7�1�7�1�7�1�7�0�7�1�7�1�75�1�7�1�7�1�7�1�7�1�7�1�7�1�7�1�7�1�7�1�7�1�7�1�7�1�7�1�7
4.???? �1�7�1�7�1�7�1�7�1�7�1�7�1�7�1�7�1�7�0�8�1�7�1�7�1�7�1�7�1�7�1�7�1�7�1�7�1�7�0�7�1�7�1�75�1�7�1�7�1�7�1�7�1�7�1�7�1�7�1�7�1�7�1�7�1�7�1�7�1�7�1�71�1�7�1�7�1�7�1�7�1�7�0�5�1�7�1�7�1�7�1�7�1�7�1�7�1�7�1�7
5.???? �1�7�1�7�1�7�0�1�1�7�0�8�1�7�1�7�1�7�1�1�1�7�1�7�1�7�1�7�8�0�1�7�1�7�1�7�1�7�1�7�1�7�0�7�1�7�1�75�1�7�1�7�1�7�1�7�1�7�1�7�1�7�1�7�1�7�1�7�1�7�1�7�1�7�1�71�1�7�1�7�1�7�1�7�1�7�1�7�1�7�1�7�1�7�1�7�1�7�1�7�1�7�1�7�1�7
6.???? �1�7�0�3�1�7�0�2�1�7�1�7�1�7�1�7�1�7�1�7�1�7�1�7�1�7�1�7�1�7�1�7�1�7�1�7�1�7�1�7�1�7�1�7�1�7�1�7�1�7�1�7�1�7�0�5�1�7�1�7�1�7�1�7�1�7�1�7�1�7�1�7�1�7�1�7�1�7�1�7


***************************************************************************************/
void main(void)
{
	INT8U KK;

	InitSysclk(1);

	InitT1();
	InitADIO();
	Init_MotorSpeed();
    InitMotorIO();
	Init_Usart1();
	Iint_T5(); //WT.EDIT
	//InitMotorForward();
	InitFanEdgeIO();
	InitLed();
	
	InitPowerIn();
	Init_IR();
	InitBuzzer();
	SetBuzzerTime(2);
	InitIMP();
	KeyInit(); //WT.EDIT 
	ReChargeBatter_Init();//WT.EDIT 
	Init_MotorSpeedIR();
	ADCtl=1;
	//LedBlueON();
	EdgeCollectDelayTime=0;
	RunStep=0;
	RCurrentMax=300;
	LCurrentMax=300;
	LCurrent=0;
	RCurrent=0;
	FanPersent=0;
	EdgePersent=0;
	EdgeCurrent=0;
	FanCurrent=0;
	EdgeCurrentCount=0;
	EdgeCurrentCount2=0;
	Gong_Step=0;
	Enter3=0;
	Mode=1;
	Step=0;
	ModeBackup=0;
	while(1)
	{
      
	   KK=HDKey_Scan(0);

	  if(BatterCharge ==1|| P1_0 ==1){
	     AllStop();
		 LedGreenON();
		 Delay_ms(500);
		 LedGreenOff();
		 Delay_ms(500);
	  
	  }
	  else{
            
			 switch (KK)
			 {

			 case 0 :  //run last mode setection 

              
			    break;
			 case 1: //PowerOn status
				  Mode_PowerOnStatus();
 
				 break;
			 case 2: //works mode be selected 
					Mode_WorksSelection();
			 	break; 
			 case 3: //Mode =1 ,random Run 
					 Mode_OneRandomRun();
			 	break;

			 case 4: //Mode = 2 ,fixed point 

			 	break;

			 case 5: //Mode =3 ,edgeways

			 	break; 

			 case 6:  //Mode =4  ,random

			 	break;

			 case 7:  //Mode =5 , recharge to batter

			 	break;
			 
			 default:
				 break;
			 }
	         
	        // CheckMode(KK);
	       //  CheckGround();
	       //  CheckRun();
		  
		
	     
		 }

		
	  }
	
  }


/************************************************************
	*
	*Function Name:void INT8_17_Rpt() interrupt INT8_17_VECTOR 
	*Function :GPIO �1�7�؁0�8�1�7�1�7�1�7,�1�7�؁0�8�1�7 INT15,INT14
	*
	*
************************************************************/
void INT8_17_Rpt() interrupt INT8_17_VECTOR 
{
	if(PINTF2&0x01)						//�1�7�؄1�7INT15�1�7�؁0�9�1�7�0�4��
	{
	  PINTF2 &=~ 0x01;				//�1�7�1�7�1�7INT15�1�7�؁0�9�1�7�0�4��		
	  ReadLeftPulsed();
	}
	if(PINTF2&0x02)						//�1�7�؄1�7INT15�1�7�؁0�9�1�7�0�4��
	{
	  PINTF2 &=~ 0x02;				//�1�7�1�7�1�7INT15�1�7�؁0�9�1�7�0�4��		
	  ReadRightPulsed();
	}
	 
	if(PINTF1&0x80)						//�1�7�؄1�7INT15�1�7�؁0�9�1�7�0�4��
	{
		PINTF1 &=~ 0x80;				//�1�7�1�7�1�7INT15�1�7�؁0�9�1�7�0�4��

	}

	#if 1
	if(PINTF1&0x40)						//�1�7�؄1�7INT14�1�7�؁0�9�1�7�0�4��--IR
	{
		PINTF1 &=~ 0x40;	//�1�7�1�7�1�7INT14�1�7�؁0�9�1�7�0�4��	
		#if IR3
		    Read_Remote1IR();  //ir3
		#endif 
		#if IR1
		   Read_Remote11IR(); //ir1
		#endif 
		#if IR2
		   Read_Remote12IR(); //ir2
		   
		  #endif 
	}
   #endif
	
}
/****************************************************************
	*
	*Function Name :void TIMER1_Rpt(void) interrupt TIMER1_VECTOR
	*Function:�1�7�1�7�0�2�1�7�1�7T1 ,�1�7�؁0�8�1�7�1�7�1�7 0.1ms�1�7�1�7�1�7�1�7�1�7�؄1�7

	*
	*
****************************************************************/
void TIMER1_Rpt(void) interrupt TIMER1_VECTOR
{
  
  static INT8U t_10ms;
  static INT8U t_100ms;
  static INT8U t_1s;
  t_10ms++;
  ReadAD5ms();
 // Remote1_Count(); //ir3
 // Remote11_Count();//ir1
   Remote12_Count(); //ir2
  if(t_10ms>99) //10ms
  {
  	t_10ms=0;
	t_100ms++;
	t_1s++;
	 ReadTimeOver++;
	InterruptTime ++ ; //10ms
	  RunMs++;
 	  CheckLeftMotorSpeed();
	  CheckRightMotorSpeed();
	  AdjustSpeed();
	CheckBuzzer();
	CheckVoltage();
	if(t_100ms>9) //100ms
	{
	 
	  t_100ms=0;
	   Run100MSecond++;
	   KeydelayTime++;
	   KeyRunTime++;
	  CheckLCurrent();
	  CheckRCurrent();
	  CheckFanCurrent();
	  CheckEdgeCurrent();
	  ReadIMP();  //IR impact 

	  #if 0
	  Usart1Send[0]=19;
	  Usart1Send[1]=Voltage/100;
	  Usart1Send[2]=Voltage%100;
	  Usart1Send[3]=Mode;
	  Usart1Send[4]=Step;

	  Usart1Send[5]=RunStep;
	  Usart1Send[6]=ImpStatus;
	  Usart1Send[7]=EdgeCurrent>>8;
	  Usart1Send[8]=EdgeCurrent;
	  Usart1Send[9]=GroundDp[0];
	  Usart1Send[10]=GroundDp[1];
	  Usart1Send[11]=GroundDp[2];
	  Usart1Send[12]=LeftMoveMotorData.AvgSpeed;
	  Usart1Send[13]=RightMoveMotorData.AvgSpeed;
	  
	  Usart1Send[14]=LeftMoveMotorData.NowPulsed/100;
	  Usart1Send[15]=LeftMoveMotorData.NowPulsed%100;
	  Usart1Send[16]=RightMoveMotorData.NowPulsed/100;
	  Usart1Send[17]=RightMoveMotorData.NowPulsed%100;
	  Usart1Send[18]=FanCurrent>>8;
	  Usart1Send[19]=FanCurrent;
	  
//	  Usart1Send[20]=EdgeCurrent>>8;
//	  Usart1Send[21]=EdgeCurrent;

	  SendCount=1;
	  SBUF=Usart1Send[SendCount];
      #endif 

	  
	}
	
	if(t_1s>99)//100ms * 100 =1s
	{
	  t_1s=0;
	  KeyclearTime++;
	  EdgeErrordelayTime++;
	  EdgeCollectDelayTime++;
	  RunSecond++;	 
	  GroundSecond++; //1s
	  ImpSecond++;
	  
      #if 1
	  Usart1Send[0]=3;
	 // Usart1Send[1]=Voltage/100;
	 // Usart1Send[2]=Voltage%100;
	 // Usart1Send[1]=GroundDp[0];  //left 
	 // Usart1Send[2]=GroundDp[1];  //right 
	  //Usart1Send[3]=GroundDp[2];
	   Usart1Send[1]=Mode;
	  Usart1Send[2]=Step;
	  Usart1Send[3]=RunStep;
	 // Usart1Send[8]=RunStep;
	  SendCount=1;
	  SBUF=Usart1Send[SendCount];
	  #endif 
	  
	  /*
	  Usart1Send[0]=13;
	  Usart1Send[1]=LeftIR.Left;
	  Usart1Send[2]=LeftIR.Right;
	  Usart1Send[3]=LeftIR.Mid;
	  Usart1Send[4]=LeftIR.Top;

	  Usart1Send[5]=MidIR.Left;
	  Usart1Send[6]=MidIR.Right;
	  Usart1Send[7]=MidIR.Mid;
	  Usart1Send[8]=MidIR.Top;

	  Usart1Send[9]=RightIR.Left;
	  Usart1Send[10]=RightIR.Right;
	  Usart1Send[11]=RightIR.Mid;
	  Usart1Send[12]=RightIR.Top;

	  Usart1Send[13]=RunStep;
	  SendCount=1;
	  SBUF=Usart1Send[SendCount];
  	  */
	  //SBUF=Usart1Send[SendCount];	
	}
  }
}
/***************************************************************************************
  * @�0�5�1�7�1�7  	T5�1�7�؁0�5�1�7�1�7�1�7�1�7�1�7
  *	@�1�7�1�7�1�7�1�7	�1�7�1�7
  * @�1�7�1�7�1�7�1�7�0�5 �1�7�1�7
  * @�0�0		�1�7�1�7
***************************************************************************************/
void TIMER5_Rpt(void) interrupt T5_VECTOR
{     
 
	if(T5CON&0x40)                      //�1�7�0�9�1�7�0�2�1�7�8�9�1�7�0�4�1�7
    {
		
		gui_T5Value =RCAP5;			//�1�7�1�7�0�0�1�7�1�7�0�0�1�7�1�7�1�7�1�7�1�7�1�7

		Remote1_ReadIR.Interrupt_IR2 ++ ;
		
      //  Remote1_ReadIR.Interrupt_IR2=RCAP5;
		
    }
	#if 1
	if(gui_newT5Value!=gui_T5Value)
	{	
		if(gui_newT5Value>gui_oldT5Value)
		{
			gui_T5Value = gui_newT5Value-gui_oldT5Value;
		}else if(gui_newT5Value<gui_oldT5Value){
			gui_T5Value = gui_oldT5Value-gui_newT5Value;

		}
		else{
			 gui_newT5Value = gui_T5Value;
			 if(gui_oldT5Value ==0) gui_oldT5Value  = gui_T5Value ;
		}
		
	}
	#endif 
    if(InterruptTime >10){  //>6
					 // Usart1Send[0]=2;
					 // Usart1Send[1]=gui_T5Value ;//Remote1_ReadIR.ReadIRData[Remote1_ReadIR.ReadIRBit];
                     // Usart1Send[2]=Remote1_ReadIR.Interrupt_IR2  ;//0xff;
					 // SendCount=1;
					 // SBUF=Usart1Send[SendCount];
					  InterruptTime =0;
                      // Remote1_ReadIR.ReadA_Time++;
					  // Remote1_ReadIR.ReadASTAR[Remote1_ReadIR.ReadA_Time]=Remote1_ReadIR.Interrupt_IR2;
					  
					   Remote1_ReadIR.Interrupt_IR2=0;
					  
					  gui_T5Value=0;
					//  if(Remote1_ReadIR.ReadA_Time>3)Remote1_ReadIR.ReadA_Time=0;
					
		    }
		   //else Remote1_ReadIR.Interrupt_IR2 ++ ;

	
    T5CON &=~ 0x40;						//�1�7�1�7�1�7�1�7�1�7�1�7�1�7�1�7�8�9�1�7�1�7�1�7�1�7�1�7�0�4�1�7�1�7�1�7�1�7�1�7�1�7�1�7�0�4��        
	T5CON &=~ 0x80;						//�1�7�1�7�1�7T5�1�7�؁0�9�1�7�0�4��      
}

void WDT_Rpt() interrupt WDT_VECTOR
{
	WDTC &=~ 0x20;						//�1�7�1�7�1�7WDT�1�7�؁0�9�1�7�0�4��
}
